<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self' rylie.goatcounter.com/count 'self' https://*;script-src 'self' gc.zgo.at 'self'" http-equiv=Content-Security-Policy><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://rylie.moe name=base><title>
Miki Sayaka Devblog 001: Off to A Strong Start! | lumi's trashcan</title><link href=https://rylie.moe/favicon.ico rel=icon type=image/png><link title="lumi's trashcan - Atom Feed" href=https://rylie.moe/atom.xml rel=alternate type=application/atom+xml><link href="https://rylie.moe/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://rylie.moe/main.css?h=9ba37545587e359ed117" rel=stylesheet><link href="https://rylie.moe/skins/sakura.css?h=2d9c69af51135683e3bd" rel=stylesheet><meta content="light dark" name=color-scheme><meta content="my thoughts and rants." name=description><meta content="my thoughts and rants." property=og:description><meta content="Miki Sayaka Devblog 001: Off to A Strong Start!" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><meta content=https://rylie.moe/blog/sayaka-dev-01/ property=og:url><meta content="lumi's trashcan" property=og:site_name><noscript><link href=https://rylie.moe/no_js.css rel=stylesheet></noscript><script src=https://rylie.moe/js/initializeTheme.min.js></script><script defer src=https://rylie.moe/js/themeSwitcher.min.js></script><script async data-goatcounter=https://rylie.goatcounter.com/count src=https://gc.zgo.at/count.js></script><script src="https://rylie.moe/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://rylie.moe>lumi's trashcan</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://rylie.moe/blog/>blog </a><li><a class="nav-links no-hover-padding" href=https://rylie.moe/archive/>archive </a><li><a class="nav-links no-hover-padding" href=https://rylie.moe/tags/>tags </a><li><a class="nav-links no-hover-padding" href=https://rylie.moe/projects/>projects </a><li class=menu-icons-container><ul class=menu-icons-group><li class="js menu-icon"><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></ul></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Miki Sayaka Devblog 001: Off to A Strong Start!</h1><ul class=meta><li>13th Oct 2024<li title="1156 words"><span aria-hidden=true class=separator>|</span>6 min read<li class=tag><span aria-hidden=true class=separator>|</span>Tags: <li class=tag><a href=https://rylie.moe/tags/coding/>coding</a>, <li class=tag><a href=https://rylie.moe/tags/discord/>discord</a>, <li class=tag><a href=https://rylie.moe/tags/automation/>automation</a>, <li class=tag><a href=https://rylie.moe/tags/miki-sayaka/>miki sayaka</a></ul><div class=toc-container><h3>Table of Contents</h3><ul><li><a href=https://rylie.moe/blog/sayaka-dev-01/#starting-steps>Starting steps</a><li><a href=https://rylie.moe/blog/sayaka-dev-01/#planning-features>Planning features</a><li><a href=https://rylie.moe/blog/sayaka-dev-01/#getting-to-work>Getting to work</a> <ul><li><a href=https://rylie.moe/blog/sayaka-dev-01/#self-assignable-roles>Self-assignable roles</a><li><a href=https://rylie.moe/blog/sayaka-dev-01/#manga-tracking>Manga tracking</a></ul><li><a href=https://rylie.moe/blog/sayaka-dev-01/#closing-thoughts>Closing thoughts</a></ul></div><section class=body><p>I got really bored one day and I decided, hey, let’s get <em>another</em> Discord bot rolling. I haven’t been having time to maintain larger-scaled projects, including Katsumi (repo private for now, hehe~) and <a class=external href=https://github.com/j1nxie/tairitsu-rs>Tairitsu</a>, so I ended up somewhat ““derusting”“ (for the lack of a better term) by creating another bot for my own Discord server! And thus, after a week or two of work, <a class=external href=https://gitbub.com/j1xie/mikisayaka>Miki Sayaka</a> was born!<p>This is merely me writing my thoughts and process as I developed Sayaka, and this is no way a tutorial or “best practices” guide at writing Rust or developing a Discord bot! Nonetheless, I hope any readers find this interesting and educational!<h1 id=starting-steps><a aria-label="Anchor link for: starting-steps" class="header-anchor no-hover-padding" href=#starting-steps><span aria-hidden=true class=link-icon></span></a> Starting steps</h1><p>Of course, for every Discord bot I make, I start with deciding my language and library of choice. I felt like writing more Rust, so I ended up choosing the <a class=external href=https://github.com/serenity-rs/poise>poise</a> framework, built on top of the <a class=external href=https://github.com/serenity-rs/serenity>serenity</a> library.<p>Why Rust? I feel like I can grasp the language decently well, as well as write idiomatic code <em>fast enough</em> in it. Of course, I have my own qualms about it regarding async Rust as well as how ugly it gets when you want something like global states… but that’s for another time.<p>On top of this, I feel like I should learn to write my own command engine and everything… but for now, we’ll stick with Poise. Poise is opinionated, yes, but it is neat in the sense that for <em>most</em>, if not <em>all</em> of my use cases, it works and I don’t have to think too much about the structure of everything, similar to how Tairitsu was.<h1 id=planning-features><a aria-label="Anchor link for: planning-features" class="header-anchor no-hover-padding" href=#planning-features><span aria-hidden=true class=link-icon></span></a> Planning features</h1><p>I’ve always wanted to make something that can manage the self-assignable roles in my server. I have a few of them set up - colors, gaming pings, free games notifications, etc. Setting them up through <a class=external href=https://tatsu.gg>Tatsu</a> feels like a pain - and guiding people to use them isn’t the easiest either. That’s why I felt like making my own to see what’s the best way to get the user experience right.<p>On top of this, I also want to manage new chapter uploads from <a class=external href=https://mangadex.org>MangaDex</a>, as well as a recommendation list for manga. I’ve had ideas about it for a good while, making a crowd-sourced list of manga that we can say “oh yeah our server endorse this, this is pretty nice”, something in those lines. Using a Google spreadsheet feels very manual, though it definitely shines when you want someone to add their comments for a certain title, for example.<p>So, in short, we have two things to do.<ol><li>Self-assignable roles <ul><li>Display a list<li>Add and remove roles</ul><li>MangaDex chapter tracking <ul><li>Display list of tracked manga<li>Add manga to tracked list<li>Send notifications whenever a new chapter is out for the titles on the list</ul></ol><h1 id=getting-to-work><a aria-label="Anchor link for: getting-to-work" class="header-anchor no-hover-padding" href=#getting-to-work><span aria-hidden=true class=link-icon></span></a> Getting to work</h1><p>Well… Looking at the two above planned features, for starters, the self-assignable roles look much more simple to implement, and that’s where I started first.<h2 id=self-assignable-roles><a aria-label="Anchor link for: self-assignable-roles" class="header-anchor no-hover-padding" href=#self-assignable-roles><span aria-hidden=true class=link-icon></span></a> Self-assignable roles</h2><p>I prepared a little database table with two columns, <code>role_name</code> and <code>role_id</code>. The role’s name is for display purposes through Discord’s <a class=external href=https://discord.com/developers/docs/interactions/message-components>select menu</a>, and the <code>role_id</code> is… well, for assigning it to the user through Poise, of course.<p>Of course, with hindsight, I could always <em>only</em> store the role ID, and use the Discord API to fetch the role name for displaying purposes. This way, I wouldn’t need to trust myself (out of all people!) to keep the role names correct and updated. But at the same time, we haven’t changed any of our self-assignable roles in a good while, maybe a year or two now, so this is the least of my concerns.<p>Seems simple enough, right? Whatever roles I wanted to setup, I’ll fill in the name and the role ID into the database. Then, the <code>role list</code> command would fetch everything from the database and display it in a neat little embed. Similarly, <code>role add</code> would display that same list and having a dropdown to select a role. <code>role remove</code> would display the list of self-assignable roles you have, and allowing you to pick one to remove from your own roles.<p>Sure enough, implementing this was simple and it didn’t take long to get it working. I don’t have to worry about managing multiple servers and everything - after all, this was meant to be a personal Discord bot! That’s the reason why a lot of supposedly scalable design decisions were skipped - no tracking of what server ID the roles are from, no real interface to add roles to the database from the bot, and so on.<h2 id=manga-tracking><a aria-label="Anchor link for: manga-tracking" class="header-anchor no-hover-padding" href=#manga-tracking><span aria-hidden=true class=link-icon></span></a> Manga tracking</h2><p>Now <strong>this</strong> is the fun part. Thanks to the <a class=external href=https://crates.io/crates/mangadex-api>mangadex-api</a> crate, I have a neat API client for MangaDex that I could use to fetch stuff from. But, now what? Where do we start?<p>Once again, I started with managing the manga list, which also doubles up as our crowd-sourced recommendations list. Database-wise, it’s just a simple table with two columns: <code>manga_dex_id</code> and <code>last_updated</code>. The MangaDex UUID of the manga will be stored alongside the latest date we checked for new updates.<p>Of course, of course, “But but “last updated” means the last date the manga was updated“, I hear you say. Yes, the naming could be better, but who cares? I might change it when I feel like it confuses me enough, but for now, the field existing at all is what I really care about.<p>A <code>manga list</code> command is available to render the entire list. As of this point, I was really lazy so I didn’t bother with pagination or anything. I only have a few titles in the list, so it’s not like it’s going to be a problem, right?<p>The <code>manga add</code> command is up next - I’ll let users input either a MangaDex URL or the UUID of the manga on MD, and we’ll add it to the database. At the same time, the bot takes a MDList UUID and for every manga added it will attempt to sync the database to the MDList.<p>Skipping the remove for now because… truth be told I cannot figure out a good UX to remove stuff… I’ll just hook straight into the database and remove entries I guess.<h1 id=closing-thoughts><a aria-label="Anchor link for: closing-thoughts" class="header-anchor no-hover-padding" href=#closing-thoughts><span aria-hidden=true class=link-icon></span></a> Closing thoughts</h1><p>As of right now, Miki Sayaka is up and running pretty neatly! Of course, there’s still plenty more to do - paginating the lists, actually notifying new chapters, and so on. But for now, this is a good starting place for Sayaka! Source code for the bot is always available on the <a class=external href=https://github.com/j1nxie/mikisayaka>GitHub repo</a>, feel free to check it out! Thanks a lot for reading!</section></article></main><div id=button-container><div id=toc-floating-container><input class=toggle id=toc-toggle type=checkbox><label class=overlay for=toc-toggle></label><label title="Toggle Table of Contents" class=button for=toc-toggle id=toc-button><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg></label><div class=toc-content><div class=toc-container><ul><li><a href=https://rylie.moe/blog/sayaka-dev-01/#starting-steps>Starting steps</a><li><a href=https://rylie.moe/blog/sayaka-dev-01/#planning-features>Planning features</a><li><a href=https://rylie.moe/blog/sayaka-dev-01/#getting-to-work>Getting to work</a> <ul><li><a href=https://rylie.moe/blog/sayaka-dev-01/#self-assignable-roles>Self-assignable roles</a><li><a href=https://rylie.moe/blog/sayaka-dev-01/#manga-tracking>Manga tracking</a></ul><li><a href=https://rylie.moe/blog/sayaka-dev-01/#closing-thoughts>Closing thoughts</a></ul></div></div></div><a title="Go to the top of the page" class=no-hover-padding href=# id=top-button> <svg viewbox="0 0 20 20" fill=currentColor><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg> </a></div><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://rylie.moe/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://rylie.moe/atom.xml> <img alt=feed loading=lazy src=https://rylie.moe/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/j1nxie> <img alt=github loading=lazy src=https://rylie.moe/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://steamcommunity.com/id/cauvong-chan> <img alt=steam loading=lazy src=https://rylie.moe/social_icons/steam.svg title=steam> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://anilist.co/user/Lumi9> <img alt=anilist loading=lazy src=https://rylie.moe/social_icons/anilist.svg title=anilist> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://rylie.moe/sitemap.xml> sitemap </a></ul> </small></nav><div class=credits><small> <p><p>lumi’s trashcan © 2022-2025 lumi</p> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> </small></div></section><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>